<UserControl x:Class="CbcRoastersErp.Views.SalesDashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:vm="clr-namespace:CbcRoastersErp.ViewModels"
             xmlns:local="clr-namespace:CbcRoastersErp.Views"
             Background="{DynamicResource MaterialDesignPaper}"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">

    <UserControl.DataContext>
        <vm:SalesDashboardViewModel />
    </UserControl.DataContext>

    <DockPanel Margin="10">

        <!-- Header Title -->
        <Border Background="{DynamicResource PrimaryHueDarkBrush}" Padding="20" DockPanel.Dock="Top">
            <TextBlock Text="{Binding DateRangeText}" 
                       Foreground="White" 
                       FontSize="22" 
                       FontWeight="SemiBold"/>
        </Border>

        <!-- KPI Cards -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10" DockPanel.Dock="Top">
            <!-- Total Orders -->
            <materialDesign:Card Width="150" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Total Orders" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalOrders}" FontSize="20" FontWeight="Bold" Foreground="Green" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Shipped -->
            <materialDesign:Card Width="150" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Shipped" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalShipped}" FontSize="20" FontWeight="Bold" Foreground="Blue" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>
            <!-- Awaiting Payment -->
            <materialDesign:Card Width="150" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Awaiting Payment" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalAwaitingPayment}" FontSize="20" FontWeight="Bold" Foreground="DarkOrange" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Awaiting Fulfillment -->
            <materialDesign:Card Width="150" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Awaiting Fulfillment" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalAwaitingFulfillment}" FontSize="20" FontWeight="Bold" Foreground="Orange" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Awaiting Shipment -->
            <materialDesign:Card Width="150" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Awaiting Shipment" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalAwaitingShipment}" FontSize="20" FontWeight="Bold" Foreground="Red" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Total Sales -->
            <materialDesign:Card Width="180" Margin="10">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="Total Sales ($)" FontWeight="Bold" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding TotalSalesAmount, StringFormat=C}" FontSize="20" FontWeight="Bold" Foreground="DarkGreen" HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>
        </StackPanel>

        <!-- Filters and Buttons -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10" DockPanel.Dock="Top">
            <DatePicker SelectedDate="{Binding StartDate, Mode=TwoWay}" Margin="5"/>
            <DatePicker SelectedDate="{Binding EndDate, Mode=TwoWay}" Margin="5"/>
            <Button Content="Apply Dates" Command="{Binding DateChangedCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="Last 30 Days" Command="{Binding SetLast30DaysCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="This Year" Command="{Binding SetThisYearCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="Last Year" Command="{Binding SetLastYearCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="Toggle Theme" Command="{Binding ToggleThemeCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
        </StackPanel>



        <!-- Chart Toggle -->
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10" DockPanel.Dock="Top">
            <Button Content="Toggle Chart (Bar/Pie)" Command="{Binding ToggleChartCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="Refresh" Command="{Binding RefreshCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
            <Button Content="Back" Command="{Binding NavigateBackCommand}" Margin="5" Style="{StaticResource MaterialDesignOutlinedButton}" />
        </StackPanel>

        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" Margin="10" DockPanel.Dock="Bottom">
            <!-- Snackbar Notification -->
            <materialDesign:Snackbar Message="{Binding SnackbarMessage}" 
                                 IsActive="{Binding IsSnackbarActive}" 
                                 HorizontalAlignment="Center" 
                                 VerticalAlignment="Bottom" 
                                 Margin="20"
                                 Width="300"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Margin="10">

            <!-- Loading Spinner -->
            <Grid Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ProgressBar IsIndeterminate="True" 
                             Height="8" 
                             Width="200" 
                             Foreground="{DynamicResource PrimaryHueMidBrush}" 
                             HorizontalAlignment="Center" 
                             VerticalAlignment="Center" />
            </Grid>
            
            <!-- Bar Chart -->
            <Grid>
            <lvc:CartesianChart Series="{Binding SeriesCollection}" 
                                Visibility="{Binding ShowPieChart, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                <lvc:CartesianChart.AxisX>
                    <lvc:Axis Labels="{Binding Labels}" />
                </lvc:CartesianChart.AxisX>
            </lvc:CartesianChart>

            <!-- Pie Chart -->
            <lvc:PieChart Series="{Binding PieSeriesCollection}" 
              Margin="20"
              LegendLocation="Right"
              InnerRadius="0"
              Visibility="{Binding ShowPieChart, Converter={StaticResource BooleanToVisibilityConverter}}"
              HoverPushOut="15"
              Foreground="Black">
            </lvc:PieChart>
                <!-- Loading Overlay -->
                <Grid Background="#80000000"
                      Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10">
                        <ProgressBar IsIndeterminate="True" 
             Height="8" 
             Width="200" 
             Foreground="{DynamicResource PrimaryHueMidBrush}" 
             HorizontalAlignment="Center" 
             VerticalAlignment="Center" />
                        <TextBlock Text="Loading..." Foreground="White" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
        

    </DockPanel>

</UserControl>
